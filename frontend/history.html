<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø³Ø¬Ù„ - Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }

        .history-table th,
        .history-table td {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .history-table th {
            background: var(--light-gray);
            font-weight: 600;
            color: var(--dark);
        }

        .history-table tr:hover {
            background: var(--light-gray);
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-target {
            background: var(--success);
            color: var(--white);
        }

        .status-stop {
            background: var(--danger);
            color: var(--white);
        }

        .status-neutral {
            background: var(--gray);
            color: var(--white);
        }

        .profit-positive {
            color: var(--success);
            font-weight: bold;
        }

        .profit-negative {
            color: var(--danger);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>ğŸ“ˆ Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h1>
                <p>ØªÙˆØµÙŠØ§Øª Ø°ÙƒÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
            </div>
            <nav class="nav">
                <a href="index.html">Ø§Ù„ØªÙˆØµÙŠØ§Øª</a>
                <a href="stats.html">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a>
                <a href="history.html" class="active">Ø§Ù„Ø³Ø¬Ù„</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <div class="recommendations-section">
                <h2>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„ØµÙÙ‚Ø§Øª</h2>
                
                <div id="historyContent" class="loading">
                    Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Â© 2025 Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£Ø³Ù‡Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© | Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
            <p class="disclaimer">âš ï¸ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙÙ‚Ø· - Ø§Ø³ØªØ´Ø± Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ù…Ø§Ù„ÙŠ</p>
        </div>
    </footer>

    <script>
        const API_BASE_URL = 'http://13.53.169.204:8000/api';

        async function loadHistory() {
            try {
                const response = await fetch(`${API_BASE_URL}/trades/history`);
                
                if (!response.ok) {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
                const data = await response.json();
                const trades = data.trades || [];
                
                if (trades.length === 0) {
                    document.getElementById('historyContent').innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--gray);">
                            Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØµÙÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
                        </div>
                    `;
                    return;
                }
                
                const tableHTML = `
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø³Ù‡Ù…</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©</th>
                                <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${trades.map(trade => {
                                const statusText = trade.status === 'target_hit' ? 'ÙˆØµÙ„ Ù„Ù„Ù‡Ø¯Ù' :
                                                 trade.status === 'stop_loss_hit' ? 'ÙˆÙ‚Ù Ø®Ø³Ø§Ø±Ø©' : 'Ù…Ø­Ø§ÙŠØ¯';
                                const statusClass = trade.status === 'target_hit' ? 'status-target' :
                                                  trade.status === 'stop_loss_hit' ? 'status-stop' : 'status-neutral';
                                const profitClass = trade.profit_loss >= 0 ? 'profit-positive' : 'profit-negative';
                                const typeText = trade.recommendation_type === 'buy' ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹';
                                
                                return `
                                    <tr>
                                        <td><strong>${trade.symbol}</strong></td>
                                        <td>${typeText}</td>
                                        <td>${trade.entry_price.toFixed(2)}</td>
                                        <td>${trade.exit_price.toFixed(2)}</td>
                                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                        <td class="${profitClass}">${trade.profit_loss.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                                        <td class="${profitClass}">${trade.profit_loss_percent.toFixed(2)}%</td>
                                        <td>${new Date(trade.exit_date).toLocaleDateString('ar-SA')}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
                
                document.getElementById('historyContent').innerHTML = tableHTML;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('historyContent').innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--danger);">
                        âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±<br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', loadHistory);
    </script>
</body>
</html>
